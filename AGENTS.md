# AGENTS.md - Coding Agent Guidelines

This document provides guidelines for AI coding agents working in this codebase.

## Project Overview

Noteworthy is a full-stack note-taking application built with:
- **Frontend**: Next.js 16 (App Router), React 19, TypeScript, Tailwind CSS 4
- **Backend**: Convex (serverless database + real-time sync)
- **Auth**: Better Auth with Convex integration
- **UI Components**: Radix UI primitives with shadcn/ui patterns

## Build, Lint, and Test Commands

```bash
npm run dev          # Start Next.js dev server (localhost:3000)
npx convex dev       # Start Convex dev server (separate terminal)
npm run build        # Build for production
npm run lint         # Run ESLint
npx convex deploy    # Deploy Convex to production
```

**Note**: No test framework configured yet. If adding tests, consider Vitest.

## Project Structure

```
app/                    # Next.js App Router pages
  (auth)/               # Auth route group (login, register)
  (dashboard)/          # Dashboard route group (notes, canvas)
  api/                  # API routes (auth handlers)
components/             # React components
  ui/                   # shadcn/ui primitives (Button, Input, etc.)
convex/                 # Convex backend
  schema.ts             # Database schema definitions
  _generated/           # Auto-generated types (DO NOT EDIT)
lib/                    # Utility functions
providers/              # React context providers
```

## Code Style Guidelines

### TypeScript
- **Strict mode enabled** - always use proper types
- Use `interface` for object shapes, `type` for aliases
- Import types with `type` keyword: `import type { Metadata } from "next"`
- Use Convex generated types: `Id<"notes">`, `Id<"tags">`

### Import Order
1. `"use client"` directive (if present)
2. React/framework imports
3. External libraries
4. Internal imports (`@/` path alias)
5. Relative imports

```typescript
"use client";

import { useState } from "react";
import { useQuery, useMutation } from "convex/react";
import { api } from "@/convex/_generated/api";
import { Id } from "@/convex/_generated/dataModel";
import { Button } from "@/components/ui/button";
```

### React Components
- Use **function declarations**, not arrow functions
- Client components need `"use client"` directive
- Export named components (except page defaults)

```typescript
"use client";

export function NoteEditor({ noteId }: NoteEditorProps) {
  // ...
}
```

### Convex Backend
- Use `query()` and `mutation()` from `"./_generated/server"`
- Always validate user identity before data access
- Use `v` validators from `"convex/values"` for args

```typescript
import { v } from "convex/values";
import { mutation, query } from "./_generated/server";

export const getNote = query({
  args: { id: v.id("notes") },
  handler: async (ctx, args) => {
    const identity = await ctx.auth.getUserIdentity();
    if (!identity) return null;
    // ...
  },
});
```

### Error Handling
- Mutations: `throw new Error("Not authenticated")` when auth required
- Queries: Return `null` or `[]` when unauthenticated
- Client-side: Use try/catch with `console.error`

```typescript
// Client-side pattern
try {
  await createTag({ name: newTagName.trim(), color: selectedColor });
} catch (error) {
  console.error("Failed to create tag:", error);
}
```

### Naming Conventions
- **Files**: PascalCase for components (`NoteEditor.tsx`), camelCase for utilities
- **Components**: PascalCase (`NoteEditor`, `TagManager`)
- **Functions/hooks**: camelCase (`handleCreateNote`, `useQuery`)
- **Constants**: UPPER_SNAKE_CASE (`TAG_COLORS`)
- **Props interfaces**: ComponentName + "Props" (`NoteEditorProps`)

### Tailwind CSS
- Use `cn()` utility for conditional classes
- Prefer utility classes over custom CSS
- Use CSS variables for theming (`bg-background`, `text-foreground`)

```typescript
import { cn } from "@/lib/utils";

<div className={cn("base-classes", condition && "conditional-classes")} />
```

### UI Components (shadcn/ui)
- Primitives in `components/ui/` - avoid modifying unless necessary
- Use `cva()` for variant styling
- Built on Radix UI primitives

### Convex Schema
Define tables with proper indexes:

```typescript
notes: defineTable({
  title: v.string(),
  userId: v.string(),
}).index("by_user", ["userId"])
  .index("by_user_updated", ["userId", "updatedAt"]),
```

### State Management
- Server state: Convex `useQuery` and `useMutation`
- Local UI state: React `useState`
- Debounce saves with `useRef` and `setTimeout`

## Environment Variables

- `NEXT_PUBLIC_CONVEX_URL` - Convex deployment URL
- `SITE_URL` - Site URL for auth callbacks

## Do Not Edit

- `convex/_generated/` - Auto-generated by Convex CLI
- `components/ui/` - shadcn/ui primitives (avoid modifications)
